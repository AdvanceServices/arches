{% load i18n %}
<!-- ko ifnot: loading() -->
<!-- ko ifnot: fileAdded() -->
<div data-bind="dropzone: dropzoneOptions" class="file-select loader-select" style="height: 100%; width: 100%">
    <div>
        <div class="manifest-manager-main-menu-circle loader-button">
            <span><i style="color: #000" class="fa fa-cloud-upload r-select-icon"></i></span>
        </div> 
        <h2>{% trans 'Upload .csv File' %}</h2>
        <h4>{% trans 'Drag & Drop your file onto this area to upload' %}</h4>
        <div style="display: flex; padding: 15px 25px; flex-direction: column; justify-content: center; align-items: center;">
            <div style="display:flex; flex-direction: column;">
                <div>
                    <div class="dropzone-photo-upload">
                        <div style="border-top: 1px solid #c4c4c4; margin-bottom: 15px;" class="btn btn-primary btn-labeled btn-lg fa fa-file fileinput-button dz-clickable" data-bind="css: uniqueidClass" role="button">
                        {% trans 'Select File' %}
                        </div>
                        <div style="border-top: 1px solid #c4c4c4; margin-bottom: 15px;" class="btn btn-danger btn-labeled btn-lg fa fa-times-circle" data-bind="click: function() { $parent.selectedModule(null) }" role="button">
                            {% trans 'Cancel File Import' %}
                        </div>
                        <div style="min-height: 100%;">
                            <div id="hidden-dz-previews" style="display:none"></div>
                        </div>
                    </div>
                </div>
            </div>
            <h5 class="rr-splash-description">
                {% trans 'Use this workflow to upload a file with data that you want to use to create new data instances of a model.' %}
            </h5>
        </div>
    </div>
</div>
<!-- /ko -->

<!-- ko if: fileAdded() -->
<div class="etl-module-writer-container" style="display: inline-flex; flex-direction: column;">
    <div class="etl-module-preview-container" style="display: inline-flex; flex-direction: row;">
        <div class="etl-module-mapping" style="height: calc(100vh - 50px); width: 400px; padding: 25px; overflow: scroll;" data-bind="resizableSidepanel:true">
            <h3>{% trans "Format: Single .csv File Import" %}</h3>

            <div class="etl-module-mapping" style="margin: 50px 0px;">
                <h4>{% trans "Target Model" %}</h4>
                <select data-bind="
                    value: selectedGraph,
                    options: graphs,
                    optionsText: 'name',
                    optionsValue: 'graphid',
                    optionsCaption: '{% trans "Select a Resource Model..." %}',
                    valueAllowUnset: true,
                    chosen: {width: '100%'}"
                ></select>
            </div>

            <h4>{% trans "Import Details" %}</h4>
            <label class="form-checkbox form-normal form-primary" style="padding-left: 25px; padding-top: 3px;">
                <input type="checkbox" data-bind="checked: hasHeaders">{% trans "Column names in the first row" %}
            </label>
            <div class="etl-table">
                <table class="table table-striped" style="margin-top: 25px; border: 1px solid rgba(0,0,0,0.14)">
                    <thead>
                        <tr>
                            <th>{% trans "Copy From" %}</th>
                            <th>{% trans "Import To" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ko foreach: { data: fieldMapping, as: 'mapping', noChildContext: true } -->
                        <tr>
                            <td data-bind="text: mapping.field"></td>
                            <!-- ko if: nodes() -->
                            <td>
                                <select data-bind="
                                    value: mapping.node,
                                    options: nodes,
                                    optionsText: 'name',
                                    optionsCaption: '{% trans "Select a Node..." %}',
                                    optionsValue: 'name',
                                    valueAllowUnset: true,
                                    chosen: {width: '100%'}"
                                ></select>
                            </td>
                            <!-- /ko -->
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="etl-module-preview" style="height: calc(100vh - 50px); width: calc(100vw - 400px); padding: 25px; overflow: scroll;">
            <h3>{% trans "Data Preview" %}</h3>
            <div class="etl-module-info" style="font-size: 10pt; margin: 50px 0px;">
                <h4>{% trans "File Info" %}</h4>
                <div data-bind="text: fileInfo().name"></div>
                <div data-bind="html: '{% trans "File Size: " %}' + formatSize(fileInfo().size)"></div>
                <div data-bind="text: '{% trans "Number of Row: " %}' + numberOfRow()"></div>
            </div>
            <div class="etl-table" style="margin-bottom: 50px;">
                <table class="table table-striped" style="margin-top: 25px; border: 1px solid rgba(0,0,0,0.14)" width="100%">
                    <thead>
                        <tr>
                            <!-- ko foreach: headers -->
                            <th data-bind="text: $data"></th>
                            <!-- /ko -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ko foreach: { data: csvExample, as: "row", noChildContext: true }-->
                        <tr>
                            <!-- ko foreach: { data: row, as: "cell" }  -->
                            <td data-bind="text: cell"></td>
                            <!-- /ko -->
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
                <!-- ko if: csvExample().length >= 5-->
                <div data-bind="text: '{% trans 'Showing First ' %}' + csvExample().length + '{% trans ' Rows' %}'"></div>
                <!-- /ko -->
                <!-- ko ifnot: csvExample().length >= 5 -->
                <div data-bind="text: '{% trans 'Showing All ' %}' + csvExample().length + '{% trans ' Rows' %}'"></div>
                <!-- /ko -->
            </div>
            <div>
                <!-- ko if: validated -->
                <h4>{% trans "Validation Errors" %}</h4>
                <table class="table table-striped" style="margin-top: 25px; border: 1px solid rgba(0,0,0,0.14)" width="100%">
                    <thead>
                        <tr>
                            <th data-bind="text: 'Column Name'"></th>
                            <th data-bind="text: 'Error Message'"></th>
                            <th data-bind="text: 'Examples'"></th>
                        </tr>
                    </thead>
                    <!-- ko if: validationError().length -->
                    <tbody>
                        <!-- ko foreach: validationError -->
                        <tr>
                            <td data-bind="text: column"></td>
                            <td data-bind="text: error"></td>
                            <td data-bind="text: example"></td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                    <!-- /ko -->
                    <!-- ko ifnot: validationError().length -->
                    <tbody>
                        <tr>
                            <td colspan="3">{% trans "No Error Found" %}</td>
                        </tr>
                    </tbody>
                    <!-- /ko -->                
                </table>
                <!-- /ko -->
            </div>
            <div class="etl-module-buttons" style="display: inline-flex; flex-direction:row; justify-content: flex-end; margin-top: 25px;">
                <button data-bind="click: function () { fileAdded(false); }" class="btn btn-primary" style="margin-right: 10px;">
                    <span>{% trans "Remove File" %}</span>
                </button>
                <button data-bind="click: changeFormat()" class="btn btn-primary" style="display: none; margin-right: 10px;">
                    <span>{% trans "Select a different format" %}</span>
                </button>
                <button data-bind="click: validate()" class="btn btn-success" style="margin-right: 10px;">
                    <span>{% trans "Validate data before import" %}</span>
                </button>
                <!-- ko if: validated() && validationError().length === 0 -->
                <button data-bind="click: write()" class="btn btn-success" style="margin-right: 10px;">
                    <span>{% trans "Import data" %}</span>
                </button>
                <!-- /ko-->
                <button data-bind="click: function () { $parent.selectedModule(null); }" class="btn btn-danger" style="margin-right: 10px;">
                    <span>{% trans "Cancel File Import" %}</span>
                </button>
            </div>    
        </div>
    </div>
</div>
<!-- /ko -->
<!-- /ko -->