{% load i18n %}

<!-- ko let: { self: $data } -->
    <!-- ko if: !loading() -->
    <div 
        style="
            height: inherit;
            display: flex;
        "
    >
        <!-- ko if: tile() && card() -->
        <div
            style="
                display: flex;
                flex-direction: column;
                flex: 1 1 auto;
                overflow-y: scroll;
                padding-bottom: unset;
                max-width: 50%;
            "
        >
            <div data-bind="component: {
                name: cardComponentLookup[card().model.component_id()].componentname,
                params: {
                    card: card(),
                    tile: tile(),
                    provisionalTileViewModel: provisionalTileViewModel,
                    reviewer: reviewer,
                    loading: loading,
                    form: $data,
                    pageVm: $root
                }
            }"></div>

            <button
                class="btn btn-success"
                style="
                    position: relative;
                    top: -84px;
                    right: -58px;
                    width: 80px;
                "
                data-bind="click: function(){ console.log($data, $parent); $data.tile().save(); }"
            >
                <i class="ion-android-cloud-done"></i>
                <span>{% trans 'Save' %}</span>
            </button>
        </div>

        <div
            style="
                display: flex;
                flex-direction: column;
                flex: 1 1 auto;
                overflow-y: scroll;
                padding-bottom: unset;
                max-width: 50%;
                padding: 24px;
                border-left: 1px solid #ddd;
                background-color: #eee;
                box-sizing: border-box;
            "
        >
            <h4 data-bind="text: (itemName())"></h4>

            <!-- ko if: card().tiles().length === 0 -->
            <div
                style="
                    border: 1px solid #cfcfcf;
                    border-radius: 2px;
                    padding: 24px;
                    background-color: #e9e9e9;
                "                
            >
                    <p data-bind="text: `No ${itemName()} added yet.`"></p>
                    <div data-bind="text: `Add one or multiple ${itemName()}.`"></div>
            </div>
            <!-- /ko -->

            <!-- ko foreach: {data: card().tiles, as: 'tile'} -->
                <div class="wf-multi-tile-step-card">
                    <div class="wf-multi-tile-card-info">
                        <div class="workflow-step-icon complete"><span><i class="fa fa-hashtag"></i></span></div>
                        <div class="wf-multi-tile-card-info-details">
                            <!-- ko foreach: {data: $parent.card().widgets(), as: 'widget'} -->
                                <!-- ko component: {
                                            name: widget.widgetLookup[widget.get("widget_id")()].name,
                                            params: {
                                                config: widget.configJSON,
                                                label: widget.label(),
                                                node: widget.node,
                                                value: $parent.data[widget.node_id()],
                                                state: "report"
                                            }
                                        } --><!-- /ko -->
                            <!-- /ko -->
                        </div>
                    </div>
                    <div class="wf-multi-tile-step-card-controls">
                        <span
                            data-bind="click: function(){$parent.remove(tile)}"
                        >
                            <i class="fa fa-times-circle"></i>
                            <span>{% trans "Remove" %}</span>
                        </span>

                        <span
                            data-bind="click: function(){$parent.edit(tile)}"
                        >
                            <i class="fa fa-pencil"></i>
                            <span>{% trans "Edit" %}</span>
                        </span>
                    </div>
                </div>
            <!-- /ko -->

        </div>
        <!-- /ko -->
    </div>
    <!-- /ko -->
<!-- /ko -->
