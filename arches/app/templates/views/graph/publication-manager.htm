<!--
ARCHES - a program developed to inventory and manage immovable cultural heritage.
Copyright (C) 2013 J. Paul Getty Trust and World Monuments Fund

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->
{% extends "views/graph/graph-base.htm" %}
{% load static %}
{% load template_tags %}
{% load i18n %}

{% block graph_header_title %}
{% trans "Published Graphs Manager" %}
{% endblock graph_header_title %}

{% block graph_header_buttons %}
<span style="display: flex" data-bind="if: dirty">
    <button class="btn btn-sm btn-primary btn-labeled fa fa-check" data-bind="click: save"><span>{% trans "Update Published Graph" %}</span></button>
</span>
{{ block.super }}
{% endblock graph_header_buttons %}

{% block content %}
<div style="padding: 0 20px; width: 100%;">
    <fieldset>
        <!-- ko foreach: $data.publishedGraphs() -->
        <div 
            data-bind="
                attr: { 'class': $data['publicationid'] === $parent.graphPublicationId() ? 'publication active-publication' : 'publication' },
                click: $parent.selectPublication
            "
        >
            <div style="margin-right: 12px; display: flex; align-items: center;">
                <input 
                    style="margin: 0px; cursor: pointer; pointer-events: none;" 
                    type="radio" 
                    data-bind="
                        checkedValue: $data['publicationid'], 
                        checked: $parent.graphPublicationId(),
                    "
                />
            </div>

            <div style="margin-right: 12px; width: 60px; color: green">
                <!-- ko if: $data['publicationid'] === $parent.graphPublicationIdFromDatabase() -->
                    <span><strong>{% trans 'Active' %}</strong></span>
                <!-- /ko -->
            </div>

            <div style="margin-right: 12px; width: 280px; justify-content: center; display: flex;">
                <div>
                    <span><strong>{% trans "Published Time:" %}</strong></span>
                    <span data-bind="text: $data['published_time']"></span>
                </div>
            </div>

            <div style="margin-right: 12px; width: 260px; justify-content: center; display: flex;">
                <div>
                    <span><strong>{% trans "Publisher:" %}</strong></span>
                    <!-- ko if: $parent['publishedUserData']()[$data.user_id]['first_name'] -->
                        <span data-bind="text: $parent['publishedUserData']()[$data.user_id]['first_name']"></span>
                    <!-- /ko -->
                    <!-- ko if: $parent['publishedUserData']()[$data.user_id]['last_name'] -->
                        <span data-bind="text: $parent['publishedUserData']()[$data.user_id]['last_name']">,</span>
                    <!-- /ko -->
                    <span>|</span>
                    <span data-bind="text: $parent['publishedUserData']()[$data.user_id]['username']"></span>
                </div>
            </div>

            <div style="display: flex; align-items: center; width: 500px;">
                <span><strong>{% trans "Published Notes:" %}</strong></span>

                <!-- ko if: $data['publicationid'] === $parent.graphPublicationId() -->
                    <div 
                        style="
                            overflow-y: scroll; 
                            padding-bottom: 98px;
                            margin-left: 6px;
                        "
                    >
                        <textarea 
                            style="width: 380px; height: 44px; margin-top: 25px; position: absolute; cursor: pointer;" 
                            data-bind="text: $data['notes'] || {% quoted_trans 'None' %}" 
                            readonly
                        ></textarea>
                    </div>
                <!-- /ko -->
                <!-- ko ifnot: $data['publicationid'] === $parent.graphPublicationId() -->
                    <div 
                        style="
                            overflow-y: hidden; 
                            margin-left: 6px;
                            height: 20px;
                            width: 380px;
                        "
                    >
                        <span data-bind="text: $data['notes'] || {% quoted_trans 'None' %}" readonly></span>
                    </div>
                <!-- /ko -->
            </div>

            <div 
                style="padding: 8px; width: 75px;" 
                class=""
                data-bind="attr: { 'class': $data['publicationid'] !== $parent.graphPublicationIdFromDatabase() && 'fa fa-trash fa-lg' }"
            ></div>
        </div>
        <!-- /ko -->
    </fieldset>
</div>

{% endblock content %}

{% block pre_require_js %}
{{block.super}}
<div 
    id="graphPublicationData"
    style="display: none;"
    graphPublicationData='{
        "graphs_x_published_graphs": {{graphs_x_published_graphs}},
        "graph_publication_id": "{{graph_publication_id}}",
        "user_ids_to_user_data": {{user_ids_to_user_data}},
    }'
></div>
{% endblock pre_require_js %}
