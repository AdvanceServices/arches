<!--
ARCHES - a program developed to inventory and manage immovable cultural heritage.
Copyright (C) 2013 J. Paul Getty Trust and World Monuments Fund

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->
{% extends "views/resource/resource-base.htm" %}
{% load staticfiles %}
{% load i18n %}

{% block graph_header_title %}
{% trans "Resource Editor" %}
{% endblock graph_header_title %}

{% block main_content %}
<div class="content-panel">
    <div class="ep-form-toolbar">
        <div>
            <h4 class="ep-form-toolbar-title">

            </h4>
        </div>
    </div>

    <div class="flex">
        <div class="left-panel" data-bind="resizableSidepanel:true">
            <div class="jstree jstree-default" data-bind="visible: true" style="display: none;">
                <div class="header">
                    <a data-bind="click: expandAll">Expand all</a>
                    <a data-bind="click: collapseAll" style="padding-left:5px;">Collapse all</a>
                </div>
                <ul class="jstree-container-ul jstree-children" aria-expanded="true">
                    <li role="treeitem" class="jstree-node" data-bind="css: {'jstree-open': rootExpanded, 'jstree-closed' : !rootExpanded()}">
                        <i class="jstree-icon jstree-ocl" role="presentation" data-bind="click: function(){rootExpanded(!rootExpanded())}"></i>
                        <a class="jstree-anchor" href="#" tabindex="-1">
                            <strong>
                                <i data-bind="css: graphiconclass" role="presentation"></i>
                                <span data-bind="text: displayname"></span> (<span data-bind="text: graphname"></span>)
                            </strong>
                        </a>
                        <!-- ko foreach: { data: [$data], as: 'self' } -->
                        <ul class="jstree-children" aria-expanded="true">
                            <div data-bind="template: {
                                name: 'card-tree',
                                foreach: topCards,
                                as: 'card'
                            }"></div>
                        </ul>
                        <!-- /ko -->
                    </li>
                </ul>
            </div>

            <template id="card-tree">
                <li role="treeitem" class="jstree-node" data-bind="css: {'jstree-open': card.expanded, 'jstree-closed' : !card.expanded()}">
                    <i class="jstree-icon jstree-ocl" role="presentation" data-bind="click: function(){card.expanded(!card.expanded())}"></i>
                    <a class="jstree-anchor" href="#" tabindex="-1">
                        <i class="fa fa-file-o" role="presentation"></i>
                        <span style="padding-right: 10px;" data-bind="text: card.name"></span>
                    </a>
                    <ul class="jstree-children" aria-expanded="true">
                        <!-- ko if: card.cardinality === 'n' || card.tiles().length === 0 -->
                        <li role="treeitem" class="jstree-node jstree-leaf">
                            <i class="jstree-icon jstree-ocl" role="presentation" data-bind="click: function(){expanded(!expanded())}"></i>
                            <a class="jstree-anchor" href="#" tabindex="-1">
                                <i class="fa fa-plus-circle" role="presentation"></i>
                                <span style="padding-right: 10px;">Add New <span data-bind="text: card.name"></span></span>
                            </a>
                        </li>
                        <!-- /ko -->
                        <!-- ko foreach: card.tiles() -->
                        <li role="treeitem" class="jstree-node" data-bind="css: {'jstree-open': (cards.length > 0 && expanded), 'jstree-closed' : (cards.length > 0 && !expanded()), 'jstree-leaf': cards.length === 0}">
                            <i class="jstree-icon jstree-ocl" role="presentation" data-bind="click: function(){expanded(!expanded())}"></i>
                            <a class="jstree-anchor" href="#" tabindex="-1">
                                <i class="fa fa-file" role="presentation"></i>
                                <strong style="margin-right: 10px;">
                                    <!-- ko if: card.widgets.length > 0 -->
                                    <span data-bind="text: card.widgets[0].label"></span>:
                                    <div style='display: inline;' data-bind='component: {
                                        name: self.widgetLookup[card.widgets[0].widget_id].name,
                                        params: {
                                            tile: $data,
                                            node: self.nodeLookup[card.widgets[0].node_id],
                                            config: self.widgetLookup[card.widgets[0].widget_id].config,
                                            label: self.widgetLookup[card.widgets[0].widget_id].label,
                                            value: ko.observable($data.data[card.widgets[0].node_id]),
                                            type: "resource-editor",
                                            state: "display_value"
                                        }
                                    }'></div>

                                    <!-- /ko -->
                                    <!-- ko if: card.widgets.length === 0 -->
                                    <span data-bind="text: card.name"></span>
                                    <!-- /ko -->
                                </strong>
                            </a>
                            <ul class="jstree-children" aria-expanded="true" data-bind="if: cards.length > 0">
                                <div data-bind="template: {
                                    name: 'card-tree',
                                    foreach: cards,
                                    as: 'card'
                                }"></div>
                            </ul>
                        </li>
                        <!-- /ko -->
                    </ul>
                </li>
            </template>

        </div>

        <div class="main-panel">
            <!-- main -->
        </div>
    </div>
</div>
{% endblock main_content %}

{% block tabs %}{% endblock tabs %}

{% block pre_require_js %}
{{block.super}}
    <script>
        {% autoescape off %}define('resource-editor-data', [], function() {
            return {
                graphid: '{{graphid}}',
                graphiconclass: '{{graphiconclass}}',
                graphname: '{{graphname}}',
                displayname: '{{displayname}}',
                tiles: {{tiles}},
                cards: {{cards}},
                nodes: {{nodes}},
                cardwidgets: {{cardwidgets}},
                widgets: {{widgets_json}},
                nodegroups: {{nodegroups}}
            };
        });{% endautoescape %}
    </script>
{% endblock pre_require_js %}
